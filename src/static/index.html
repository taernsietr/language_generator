<!DOCTYPE html>
<html>

    <head> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Language Generator</title>
        <style>

            * {
                font-family: "monospace";
                font-size: 12px;
            }

            body {
                display: flex;
                justify-content: center;
                flex-direction: column;
                background-color: black;
                color: #d50;
            }

            table {
                width: 85%;
            }

            .basis-full {
                flex-basis: 100%;
            }

            .basis-half {
                flex-basis: 50%;
            }

            .basis-1-4 {
                flex-basis: 25%;
            }

            .basis-3-4 {
                flex-basis: 75%;
            }

            .basis-1-3 {
                flex-basis: 33%;
            }

            .bordered {
                border: 1px solid #d50;
                margin: 5px;
            }

            .small-padding {
                padding: 10px;
            }

            .flex-row {
                display: flex;
                flex-direction: row;
            }

            .flex-col {
                display: flex;
                flex-direction: column;
            }

            .wrap {
                flex-wrap: wrap
            }

            .centered {
                justify-content: center;
            }

            .space-around {
                justify-content: space-around;
            }

            .menu-button {
                background-color: black;
                color: #d50;
                transition: 0.5s;
            }

            .menu-button:hover {
                background-color: #d50;
                color: black;
            }

            .hidden {
                display: none;
            }

            .centered-text {
                text-align: center;
            }
            
            .left-align-text {
                text-align: left;
            }

            .center-self {
                align-self: center;
            }

            .no-min-width {
                min-width: 0px;
            }

        </style>
    </head>

    <body>
        <!-- Menu, currently shows the options -->
        <div id="menu" class="flex-row space-around bordered small-padding">

        <!-- Left menu column, generation -->
            <div id="menu-column-left" class="basis-1-3 flex-col space-around small-padding">
                <div class="flex-col">
                    <button class="menu-button bordered" type="submit" onclick="getRandom('word')">Random Word</button>
                    <div class="flex-col">
                        <div class="flex-row">
                            <label class="basis-3-4 small-padding center-self no-min-width" for="WordLengthExactCheckbox">Exact number of syllables?</label>
                            <input class="basis-1-4 small-padding center-self menu-button bordered centered-text no-min-width" type="checkbox" id="wordLengthExactCheckbox" name="wordLengthExactCheckbox">
                        </div>
                        <div class="flex-row">
                            <label class="basis-3-4 small-padding center-self no-min-width" for="minSyllables">Min syllables:</label>
                            <input class="basis-1-4 small-padding center-self menu-button bordered centered-text no-min-width" type="number" value="1" id="minSyllables" name="minSyllables">
                            <label class="basis-3-4 small-padding center-self no-min-width" for="maxSyllables">Max syllables:</label>
                            <input class="basis-1-4 small-padding center-self menu-button bordered centered-text no-min-width" type="number" value="5" id="maxSyllables" name="maxSyllables">
                        </div>
                    </div>
                </div>
                <div class="flex-col">
                    <button class="menu-button bordered" type="submit" onclick="getRandom('text')">Random Text</button>
                    <div class="flex-row">
                        <label class="basis-3-4 small-padding center-self no-min-width" for="textLength">Text length:</label>
                        <input class="basis-1-4 small-padding center-self menu-button bordered centered-text no-min-width" type="number" value="50" id="textLength" name="textLength">
                    </div>
                </div>
            </div>

        <!-- Center menu column, general stuff -->
            <div id="menu-column-center" class="basis-1-3 flex-col space-around small-padding">
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="toggleInfo()">Toggle Info</button></div>
            </div>

        <!-- Right menu column, generator settings -->
            <div id="menu-column-right" class="basis-1-3 flex-col space-around small-padding">
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="saveSettings()">Save Settings</button></div>
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="loadSettings()">Load Settings</button></div>
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="toggleSettings()">Toggle Settings</button></div>
            </div>
        </div>

        <!-- Displays information about the generation settings -->
        <div id="settingsDisplay" class="flex-col space-around bordered small-padding">
            <div class="flex-row wrap centered">
                <h3 class="centered-text basis-full">Settings</h3>
                <div id="settingsContents" class="flex-col space-around basis-full"></div>
            </div>
        </div>

        <!-- Displays information about the application -->
        <div id="infoDisplay" class="flex-col space-around bordered small-padding">
            <div class="flex-row wrap centered">
                <h3 class="centered-text basis-full">Information</h3>
                <div id="infoContents" class="flex-col space-around basis-full">
                    <p class="left-align-text">
                    This (at the moment, at least) is a simple word and text generator. It is based on <i>categories</i>, which are just sets of unicode characters without any deeper meaning, and <i>patterns</i>, which represent syllable patterns - but similarly to the categories, they are treated here as simple character patterns. As such, you can create as many categories as you want, with whichever characters or groups thereof, and set up patterns so that they appear in word generation.
                    </p>
                    <p class="left-align-text">
                        TL;DR:
                        <ul>
                            <li>words are generated according to the syllable patterns;</li>
                            <li>patterns are composed of the symbols for each category;</li>
                            <li>each category is made of up groups of characters;</li>
                            <li>You can have several categories or patterns.</li>
                        </ul>
                    </p>
                </div>
            </div>
        </div>

        <!-- Displays the results of generating words or text -->
        <div id="resultsDisplay" class="flex-row centered bordered small-padding">
            <p id="results" class="centered-text">Please select one of the options above!</p>
        </div>

        <script>

            let state = {
                settingsDisplay: true,
                infoDisplay: true,
                categories: 0
            }

            loadSettings();

            function toggleInfo() {
                state.infoDisplay = (state.infoDisplay) ? false : true;
                document.getElementById("infoDisplay").className = (!state.infoDisplay) ? "flex-col space-around bordered small-padding hidden" : "flex-col space-around bordered small-padding";
                console.log("infoDisplay: " + state.infoDisplay);
            }

            function toggleSettings() {
                state.settingsDisplay = (state.settingsDisplay) ? false : true;
                document.getElementById("settingsDisplay").className = (!state.settingsDisplay) ? "flex-col space-around bordered small-padding hidden" : "flex-col space-around bordered small-padding";
                console.log("settingsDisplay: " + state.settingsDisplay);
            }

            function getRandom(type) {
                let request = new XMLHttpRequest(); 
                request.onreadystatechange = displayResponse;
                request.open("GET", "/api/" + type);
                request.send();

                function displayResponse() {
                    if (request.readyState != 4) return;
                    document.getElementById("results").innerText = request.responseText;
                }
            };

            function loadSettings() {
                let request = new XMLHttpRequest();
                request.onreadystatechange = displayResponse;
                request.open("GET", "/api/current");
                request.send();

                function displayResponse() {
                    if (request.readyState != 4) return;
                    let data = JSON.parse(request.responseText);

                    let categoryRows = "";
                    data["symbols"].forEach((symbol, index) => {
                        categoryRows += "<div class='flex-row' id='category-" +
                                        state.categories + 
                                        "'>" +
                                        "<input 'type='text' class='basis-1-4 small-padding center-self menu-button bordered no-min-width' maxlength='1' value='" + 
                                        symbol + 
                                        "'> <span class='center-self'>=</span>" + 
                                        "<input type='text' class='basis-3-4 small-padding center-self menu-button bordered no-min-width' value='" +
                                        data["categories"][index] + 
                                        "'>" +
                                        "<button class='menu-button bordered' type='submit' onclick=" +
                                        "\"removeCategory(" + "'category-" + state.categories + "')\">Remove</button>" +
                                        "</div>";
                        state.categories += 1;
                    });


                    document.getElementById("settingsContents").innerHTML = 
                        "<div class='flex-col'>" +
                        "<div id='categories' class='flex-col'>" +
                        "<h3>Categories</h3>" +
                        categoryRows.replace(/,/g, " ") +
                        "</div>" +
                        "<div id='patterns' class='flex-col'>" +
                        "<h3>Patterns</h3>" +
                        "<div class='flex-row center-self'><input type='text' class='basis-half small-padding center-self centered-text menu-button bordered no-min-width' value='" +
                        data["patterns"].join().replace(/,/g, " ") +
                        "'></div>"
                        "</div>" +
                        "</div>";
                }
            }

            function addNewCategory() {
                document.getElementById("categories").innerHTML += 
                    "<div class='flex-row' id='category-" +
                    state.categories + 
                    "'>" +
                    "<input type='text' class='basis-1-4 small-padding center-self menu-button bordered no-min-width' maxlength='1' value=''> <span class='center-self'>=</span>" + 
                    "<input type='text' class='basis-3-4 small-padding center-self menu-button bordered no-min-width' value=''></div>";
                state.categories += 1;
            }

            function removeCategory(id) {
                document.getElementById(id).remove();
            }
            
           // function saveSettings() {
           //     return
           // }
            /* 
                Add an input field for each symbol and category, along with a button for removing it;;
                Add a button for adding a new category;
                Add listener for updating client-side settings; backend should only be updated when the form is submitted to the endpoint;
            */
            
        </script>
    </body>

</html>
