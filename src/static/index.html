<!DOCTYPE html>
<html>

    <head> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Language Generator</title>
        <style>

            * {
                font-family: "monospace";
            }

            body {
                display: flex;
                justify-content: center;
                flex-direction: column;
                background-color: black;
                color: #d50;
            }

            table {
                width: 85%;
            }

            .basis-full {
                flex-basis: 100%;
            }

            .bordered {
                border: 1px solid #d50;
                margin: 5px;
            }

            .small-padding {
                padding: 10px;
            }

            .flex-row {
                display: flex;
                flex-direction: row;
            }

            .flex-col {
                display: flex;
                flex-direction: column;
            }

            .wrap {
                flex-wrap: wrap
            }

            .centered {
                justify-content: center;
            }

            .space-around {
                justify-content: space-around;
            }

            .menu-button {
                background-color: black;
                color: #d50;
                transition: 0.5s;
            }

            .menu-button:hover {
                background-color: #d50;
                color: black;
            }

            .hidden {
                display: none;
            }

            .centered-text {
                text-align: center;
            }

            .center-self {
                align-self: center;
            }

        </style>
    </head>

    <body>
        <!-- Menu, currently shows the options -->
        <div id="menu" class="flex-row space-around bordered small-padding">

        <!-- Left menu column, generation -->
            <div id="menu-column-left" class="flex-col space-around small-padding">
                <div class="flex-col">
                    <button class="menu-button bordered" type="submit" onclick="getRandom('word')">Random Word</button>
                    <input type="range" min="1" max="10" value="4" id="wordLengthSlider" class="menu-button bordered"></button>
                </div>
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="getRandom('text')">Random Text</button></div>
            </div>

        <!-- Center menu column, general stuff -->
            <div id="menu-column-center" class="flex-col space-around small-padding">
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="toggleDisplay('infoDisplay')">Toggle Info</button></div>
            </div>

        <!-- Right menu column, generator settings -->
            <div id="menu-column-right" class="flex-col space-around small-padding">
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="saveSettings()">Save Settings</button></div>
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="loadSettings()">Load Settings</button></div>
                <div class="flex-col"><button class="menu-button bordered" type="submit" onclick="toggleDisplay('settingsDisplay')">Toggle Settings</button></div>
            </div>
        </div>

        <!-- Displays information about the generation settings -->
        <div id="settingsDisplay" class="flex-col space-around bordered small-padding">
            <div class="flex-row wrap centered">
                <h3 class="centered-text basis-full">Settings</h3>
                <div id="settingsContents" class="flex-col space-around basis-full"></div>
            </div>
        </div>

        <!-- Displays information about the application -->
        <div id="infoDisplay" class="flex-col space-around bordered small-padding">
            <div class="flex-row wrap centered">
                <h3 class="centered-text basis-full">Information</h3>
                <div id="infoContents" class="flex-col space-around basis-full"></div>
            </div>
        </div>

        <!-- Displays the results of generating words or text -->
        <div id="resultsDisplay" class="flex-row centered bordered small-padding">
            <p id="results" class="centered-text">Please select one of the options above!</p>
        </div>

        <script>

            let state = {
                settingsDisplay: true,
                infoDisplay: true
            }

            loadSettings();

            function toggleDisplay(element) {
                state.element = (state.element) ? false : true;
                document.getElementById(element).className = (state.element) ? "flex-col space-around bordered small-padding hidden" : "flex-col space-around bordered small-padding";
                console.log("settingsDisplay: " + state.element);
            }

            function getRandom(type) {
                let request = new XMLHttpRequest(); 
                request.onreadystatechange = displayResponse;
                request.open("GET", "/api/" + type);
                request.send();

                function displayResponse() {
                    if (request.readyState != 4) return;
                    document.getElementById("results").innerText = request.responseText;
                }
            };

            function loadSettings() {
                let request = new XMLHttpRequest();
                request.onreadystatechange = displayResponse;
                request.open("GET", "/api/current");
                request.send();

                function displayResponse() {
                    if (request.readyState != 4) return;
                    let data = JSON.parse(request.responseText);

                    let categoryRows = "";
                    data["symbols"].forEach((symbol, index) => {
                        categoryRows += "<tr><td>" + symbol + "</td><td>" + data["categories"][index] + "</td></tr>";
                    });

                    let patternRows = "";
                    data["patterns"].forEach((pattern) => {
                        patternRows += "<tr><td>" + pattern + "</td></tr>";
                    });

                    document.getElementById("settingsContents").innerHTML = 
                    "<table class='centered-text center-self'>" +
                    "<tr><th>Categories</th><th>Elements</th></tr>" + categoryRows.replace(/,/g, " ") +
                    "</table><br>" +
                    "<table class='centered-text center-self'>" +
                    "<tr><th>Syllable Patterns</th></tr>" + patternRows.replace(/,/g, "") +
                    "</table>";
                }
            }
            
        </script>
    </body>

</html>
